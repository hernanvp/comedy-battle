<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comedy Battle üé§ - Admin</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0015 0%, #1a0033 50%, #0a0015 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        .bg-decoration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .neon-circle {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            animation: pulse 4s ease-in-out infinite;
        }

        .neon-circle:nth-child(1) {
            width: 400px;
            height: 400px;
            background: rgba(255, 0, 255, 0.3);
            top: -100px;
            left: -100px;
        }

        .neon-circle:nth-child(2) {
            width: 300px;
            height: 300px;
            background: rgba(0, 255, 255, 0.3);
            bottom: -50px;
            right: -50px;
            animation-delay: 2s;
        }

        .neon-circle:nth-child(3) {
            width: 350px;
            height: 350px;
            background: rgba(255, 255, 0, 0.2);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation-delay: 1s;
        }

        header {
            position: relative;
            z-index: 10;
            text-align: center;
            padding: 30px 20px;
            background: rgba(0, 0, 0, 0.5);
            border-bottom: 2px solid #ff00ff;
            box-shadow: 0 4px 20px rgba(255, 0, 255, 0.5);
        }

        h1 {
            font-size: 3rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow:
                0 0 10px #ff00ff,
                0 0 20px #ff00ff,
                0 0 30px #ff00ff,
                0 0 40px #ff00ff;
            animation: flicker 2s infinite alternate;
        }

        @keyframes flicker {
            0%, 18%, 22%, 25%, 53%, 57%, 100% {
                text-shadow:
                    0 0 10px #ff00ff,
                    0 0 20px #ff00ff,
                    0 0 30px #ff00ff,
                    0 0 40px #ff00ff;
            }
            20%, 24%, 55% {
                text-shadow: none;
            }
        }

        .tagline {
            margin-top: 10px;
            font-size: 1.2rem;
            color: #00ffff;
            text-shadow: 0 0 10px #00ffff;
        }

        .admin-badge {
            display: inline-block;
            margin-top: 10px;
            padding: 5px 15px;
            background: rgba(255, 0, 0, 0.3);
            border: 2px solid #ff0000;
            border-radius: 20px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        nav {
            position: relative;
            z-index: 10;
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 12px 25px;
            background: rgba(255, 0, 255, 0.2);
            border: 2px solid #ff00ff;
            color: #fff;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .nav-btn:hover {
            background: rgba(255, 0, 255, 0.5);
            box-shadow: 0 0 20px #ff00ff;
            transform: scale(1.05);
        }

        .nav-btn.active {
            background: rgba(255, 0, 255, 0.7);
            box-shadow: 0 0 30px #ff00ff;
        }

        .container {
            position: relative;
            z-index: 10;
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        section {
            display: none;
            animation: fadeIn 0.5s;
        }

        section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid #00ffff;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            color: #00ffff;
            text-shadow: 0 0 10px #00ffff;
            text-transform: uppercase;
        }

        h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #ffff00;
            text-shadow: 0 0 10px #ffff00;
        }

        /* Comedian selector */
        .comedian-selector {
            background: rgba(0, 255, 255, 0.1);
            border: 2px solid #00ffff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .comedian-selector h3 {
            color: #ffff00;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.3rem;
            text-transform: uppercase;
        }

        .comedian-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .comedian-btn {
            padding: 15px;
            background: rgba(255, 0, 255, 0.2);
            border: 2px solid #ff00ff;
            color: #fff;
            cursor: pointer;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s;
            text-align: center;
        }

        .comedian-btn:hover {
            background: rgba(255, 0, 255, 0.4);
            transform: scale(1.05);
        }

        .comedian-btn.selected {
            background: linear-gradient(45deg, #ff00ff, #00ffff);
            border-color: #ffff00;
            color: #000;
            box-shadow: 0 0 30px rgba(255, 255, 0, 0.8);
            animation: selectedPulse 1.5s infinite;
        }

        @keyframes selectedPulse {
            0%, 100% { box-shadow: 0 0 30px rgba(255, 255, 0, 0.8); }
            50% { box-shadow: 0 0 50px rgba(255, 255, 0, 1); }
        }

        /* Applause controls */
        .applause-controls {
            background: rgba(255, 0, 255, 0.1);
            border: 2px solid #ff00ff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .mic-button {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff00ff, #00ffff);
            border: 3px solid #fff;
            font-size: 3rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.5);
        }

        .mic-button:hover {
            transform: scale(1.1);
            box-shadow: 0 0 50px rgba(255, 0, 255, 0.8);
        }

        .mic-button.active {
            background: linear-gradient(45deg, #00ff00, #00ffff);
            animation: micPulse 1s infinite;
        }

        @keyframes micPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .mic-status {
            text-align: center;
            font-size: 1.2rem;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .mic-status.active {
            color: #0f0;
            text-shadow: 0 0 10px #0f0;
        }

        .mic-status.inactive {
            color: #ff0000;
        }

        .volume-meter-container {
            margin: 20px 0;
        }

        .volume-meter {
            width: 100%;
            height: 40px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #00ffff;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
        }

        .volume-bar {
            height: 100%;
            background: linear-gradient(90deg, #00ff00, #ffff00, #ff0000);
            width: 0%;
            transition: width 0.1s;
        }

        .max-marker {
            position: absolute;
            top: 0;
            height: 100%;
            width: 3px;
            background: #ffff00;
            box-shadow: 0 0 15px #ffff00;
            transition: left 0.3s;
        }

        .control-group {
            margin: 15px 0;
        }

        .control-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: #00ffff;
            font-weight: bold;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            background: rgba(0, 255, 255, 0.2);
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #ff00ff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px #ff00ff;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #ff00ff;
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px #ff00ff;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #ff00ff;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #ff00ff;
            color: #fff;
            border-radius: 5px;
            font-size: 1rem;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 10px #00ffff;
        }

        /* Max display */
        .max-display {
            text-align: center;
            padding: 30px;
            background: radial-gradient(circle, rgba(255, 255, 0, 0.3), rgba(0, 0, 0, 0.5));
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid #ffff00;
        }

        .max-counter {
            font-size: 4rem;
            font-weight: bold;
            color: #ffff00;
            text-shadow: 0 0 20px #ffff00;
            margin-bottom: 10px;
        }

        .max-label {
            font-size: 1.2rem;
            color: #00ffff;
            text-transform: uppercase;
        }

        .current-comedian {
            margin-top: 10px;
            font-size: 1.5rem;
            color: #ff00ff;
            font-weight: bold;
        }

        /* Comparison grid */
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .comparison-card {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #ff00ff;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s;
        }

        .comparison-card.active {
            border-color: #ffff00;
            box-shadow: 0 0 20px rgba(255, 255, 0, 0.5);
        }

        .comparison-card.winner {
            border-color: #00ff00;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.7);
        }

        .comparison-name {
            font-size: 1.2rem;
            color: #00ffff;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .comparison-value {
            font-size: 2.5rem;
            color: #ffff00;
            font-weight: bold;
            text-shadow: 0 0 10px #ffff00;
        }

        .comparison-label {
            font-size: 0.9rem;
            color: #ff00ff;
            margin-top: 5px;
        }

        /* Stats grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 0, 255, 0.2);
            border: 2px solid #ff00ff;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 3rem;
            font-weight: bold;
            color: #ffff00;
            text-shadow: 0 0 10px #ffff00;
        }

        .stat-label {
            margin-top: 10px;
            color: #00ffff;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        /* Ranking */
        .ranking-list {
            list-style: none;
        }

        .ranking-item {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #ff00ff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
            transition: all 0.3s;
        }

        .ranking-item:hover {
            transform: translateX(10px);
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
        }

        .ranking-item.first {
            border-color: #ffff00;
            box-shadow: 0 0 30px rgba(255, 255, 0, 0.5);
        }

        .ranking-position {
            font-size: 2rem;
            font-weight: bold;
            color: #00ffff;
            min-width: 50px;
        }

        .ranking-item.first .ranking-position::after {
            content: " üëë";
        }

        .ranking-info {
            flex: 1;
        }

        .ranking-name {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #fff;
        }

        .ranking-bar {
            background: rgba(255, 255, 255, 0.1);
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .ranking-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff00ff, #00ffff);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .ranking-score {
            font-size: 2rem;
            font-weight: bold;
            color: #ffff00;
            min-width: 100px;
            text-align: right;
        }

        /* Comedian list */
        .comedian-list {
            list-style: none;
        }

        .comedian-list-item {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #ff00ff;
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            transition: all 0.3s;
        }

        .comedian-list-item:hover {
            transform: translateX(5px);
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.5);
        }

        .comedian-list-name {
            font-size: 1.3rem;
            color: #00ffff;
            font-weight: bold;
            flex: 1;
        }

        .comedian-list-actions {
            display: flex;
            gap: 10px;
        }

        /* Buttons */
        .btn {
            padding: 15px 40px;
            background: linear-gradient(45deg, #ff00ff, #00ffff);
            border: none;
            color: #000;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.8);
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff0000, #ff00ff);
        }

        .btn-danger:hover {
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.8);
        }

        .btn-small {
            padding: 10px 20px;
            font-size: 0.9rem;
        }

        .btn-warning {
            background: linear-gradient(45deg, #ff8800, #ffff00);
        }

        .btn-warning:hover {
            box-shadow: 0 0 30px rgba(255, 136, 0, 0.8);
        }

        /* QR section */
        .qr-section {
            background: rgba(0, 0, 0, 0.5);
            border: 2px dashed #00ffff;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
        }

        .qr-placeholder {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #ff00ff;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
        }

        /* Alert box */
        .alert {
            background: rgba(255, 0, 0, 0.2);
            border: 2px solid #ff0000;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.show {
            display: block;
            animation: slideDown 0.5s;
        }

        .alert.success {
            background: rgba(0, 255, 0, 0.2);
            border-color: #0f0;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .info-box {
            background: rgba(0, 255, 255, 0.1);
            border: 2px solid #00ffff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .info-box strong {
            color: #ffff00;
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .tagline {
                font-size: 1rem;
            }

            .max-counter {
                font-size: 2.5rem;
            }

            .nav-btn {
                font-size: 0.85rem;
                padding: 10px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="bg-decoration">
        <div class="neon-circle"></div>
        <div class="neon-circle"></div>
        <div class="neon-circle"></div>
    </div>

    <header>
        <h1>üé§ Comedy Battle üé§</h1>
        <p class="tagline">Panel de Administraci√≥n</p>
        <span class="admin-badge">üîí Admin</span>
    </header>

    <nav>
        <button class="nav-btn active" onclick="showSection('aplausos')">üëè Aplaus√≥metro</button>
        <button class="nav-btn" onclick="showSection('ranking')">üèÜ Ranking</button>
        <button class="nav-btn" onclick="showSection('stats')">üìä Estad√≠sticas</button>
        <button class="nav-btn" onclick="showSection('config')">‚öôÔ∏è Configuraci√≥n</button>
    </nav>

    <div class="container">
        <!-- Applause Meter Section -->
        <section id="aplausos" class="active">
            <div class="card">
                <h2>üëè Aplaus√≥metro Individual</h2>

                <div id="mic-error" class="alert">
                    <strong>‚ö†Ô∏è Error de Micr√≥fono</strong>
                    <p>No se pudo acceder al micr√≥fono. Asegurate de dar permisos en tu navegador.</p>
                </div>

                <!-- Comedian Selector -->
                <div class="comedian-selector">
                    <h3>üìå Seleccion√° el Comediante a Medir</h3>
                    <div class="comedian-buttons" id="comedian-selector">
                        <!-- Will be populated by JS -->
                    </div>
                </div>

                <!-- Microphone Controls -->
                <div class="applause-controls">
                    <div class="mic-status inactive" id="mic-status">üî¥ Micr√≥fono Apagado</div>

                    <button class="mic-button" id="mic-button" onclick="toggleMicrophone()">
                        üé§
                    </button>

                    <p style="text-align: center; color: #00ffff; margin-bottom: 20px;">
                        Clicke√° el micr√≥fono para activar la medici√≥n de aplausos
                    </p>

                    <div class="volume-meter-container">
                        <div class="control-label">
                            <span>Volumen Actual</span>
                            <span id="volume-value">0%</span>
                        </div>
                        <div class="volume-meter">
                            <div class="volume-bar" id="volume-bar"></div>
                            <div class="max-marker" id="max-marker"></div>
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span>Suavizado del Medidor</span>
                            <span id="smoothing-value">0.8</span>
                        </div>
                        <input type="range" id="smoothing-slider" min="0" max="0.9" value="0.8" step="0.1">
                    </div>
                </div>

                <!-- Max Display -->
                <div class="max-display">
                    <div class="max-counter" id="max-counter">0</div>
                    <div class="max-label">Volumen M√°ximo (dB %)</div>
                    <div class="current-comedian" id="current-comedian">Seleccion√° un comediante</div>
                    <button class="btn btn-small" onclick="resetCurrentMax()" style="margin-top: 15px;">
                        üîÑ Reiniciar M√°ximo Actual
                    </button>
                </div>

                <!-- Comparison -->
                <div class="card" style="background: rgba(0,0,0,0.4); border-color: #ffff00;">
                    <h3 style="color: #ffff00; text-align: center; margin-bottom: 20px;">
                        üìä Comparaci√≥n de M√°ximos
                    </h3>
                    <div class="comparison-grid" id="comparison-grid">
                        <!-- Will be populated by JS -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Ranking Section -->
        <section id="ranking">
            <div class="card">
                <h2>üèÜ Ranking Final</h2>
                <p style="margin-bottom: 20px; color: #ffff00;">
                    F√≥rmula: (Votos √ó 10) + Volumen M√°ximo (dB %)
                </p>

                <ul class="ranking-list" id="ranking-list">
                    <!-- Ranking will be populated by JavaScript -->
                </ul>
            </div>
        </section>

        <!-- Stats Section -->
        <section id="stats">
            <div class="card">
                <h2>üìä Estad√≠sticas del Evento</h2>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-registrados">0</div>
                        <div class="stat-label">Registrados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-votos">0</div>
                        <div class="stat-label">Votos Totales</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-max-global">0</div>
                        <div class="stat-label">M√°ximo Global (dB %)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-comediantes">0</div>
                        <div class="stat-label">Comediantes</div>
                    </div>
                </div>

                <div class="qr-section">
                    <h3>üì± C√≥digo QR del Evento</h3>
                    <div class="qr-placeholder">üì±</div>
                    <p style="color: #00ffff;">Escane√° este QR para acceder a la p√°gina de votaci√≥n</p>
                    <p style="color: #ff00ff; margin-top: 10px;">
                        URL p√∫blica: <strong id="public-url">index.html</strong>
                    </p>
                </div>

                <button class="btn btn-danger" onclick="resetAll()" style="margin-right: 10px;">
                    üîÑ Reiniciar Todo
                </button>
                <button class="btn" onclick="exportData()">
                    üíæ Exportar Datos
                </button>
            </div>
        </section>

        <!-- Config Section -->
        <section id="config">
            <div class="card">
                <h2>‚öôÔ∏è Configuraci√≥n de Comediantes</h2>

                <div class="info-box">
                    <strong>üí° Importante:</strong> Los cambios se aplican autom√°ticamente. Si agreg√°s o borr√°s comediantes,
                    los datos de votaci√≥n y aplausos se actualizan en consecuencia.
                </div>

                <div id="config-alert" class="alert success">
                    <!-- Messages will appear here -->
                </div>

                <!-- Add/Edit Form -->
                <div class="card" style="background: rgba(255, 0, 255, 0.1); border-color: #ff00ff;">
                    <h3 id="form-title">‚ûï Agregar Nuevo Comediante</h3>

                    <form id="comedian-form" style="max-width: 600px;">
                        <input type="hidden" id="comedian-id" value="">

                        <div class="form-group">
                            <label for="comedian-name">Nombre del Comediante *</label>
                            <input type="text" id="comedian-name" required placeholder="Ej: Juan Risas">
                        </div>

                        <div style="display: flex; gap: 10px;">
                            <button type="submit" class="btn" id="submit-btn">
                                ‚úÖ Agregar Comediante
                            </button>
                            <button type="button" class="btn btn-warning" id="cancel-btn" onclick="cancelEdit()" style="display: none;">
                                ‚ùå Cancelar
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Comedians List -->
                <div class="card" style="background: rgba(0, 0, 0, 0.4);">
                    <h3>üìã Lista de Comediantes (<span id="comedian-count">0</span>)</h3>

                    <ul class="comedian-list" id="comedian-list">
                        <!-- Will be populated by JS -->
                    </ul>

                    <p style="text-align: center; color: #00ffff; margin-top: 20px;" id="empty-message">
                        No hay comediantes cargados. Agreg√° el primero arriba.
                    </p>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Audio context variables
        let audioContext;
        let analyser;
        let microphone;
        let dataArray;
        let bufferLength;
        let isListening = false;
        let animationId;
        let selectedComedianId = null;
        let currentSessionMax = 0;

        // Initialize data
        function initializeData() {
            if (!localStorage.getItem('comedyBattle')) {
                const initialData = {
                    comedians: [
                        { id: 1, name: "Diego Comediante" },
                        { id: 2, name: "Mar√≠a Risas" },
                        { id: 3, name: "Carlos Jokester" },
                        { id: 4, name: "Laura Stand-Up" }
                    ],
                    nextId: 5,
                    registrados: [],
                    votos: {},
                    maxDB: {},
                    hasVoted: false,
                    votedFor: null
                };

                // Initialize votos and maxDB for default comedians
                initialData.comedians.forEach(c => {
                    initialData.votos[c.id] = 0;
                    initialData.maxDB[c.id] = 0;
                });

                localStorage.setItem('comedyBattle', JSON.stringify(initialData));
            }
        }

        function getData() {
            return JSON.parse(localStorage.getItem('comedyBattle'));
        }

        function saveData(data) {
            localStorage.setItem('comedyBattle', JSON.stringify(data));
        }

        function getComedians() {
            const data = getData();
            return data.comedians || [];
        }

        // Comedian CRUD
        function addComedian(name) {
            const data = getData();
            const newComedian = {
                id: data.nextId,
                name: name.trim()
            };

            data.comedians.push(newComedian);
            data.nextId++;
            data.votos[newComedian.id] = 0;
            data.maxDB[newComedian.id] = 0;

            saveData(data);
            showMessage('‚úÖ Comediante agregado exitosamente', 'success');
            return newComedian;
        }

        function editComedian(id, name) {
            const data = getData();
            const comedian = data.comedians.find(c => c.id === id);

            if (comedian) {
                comedian.name = name.trim();
                saveData(data);
                showMessage('‚úÖ Comediante actualizado exitosamente', 'success');
                return true;
            }
            return false;
        }

        function deleteComedian(id) {
            const data = getData();
            const index = data.comedians.findIndex(c => c.id === id);

            if (index !== -1) {
                const comedian = data.comedians[index];

                if (confirm(`¬øEliminar a "${comedian.name}"?\n\nSe borrar√°n sus votos y r√©cord de aplausos.`)) {
                    data.comedians.splice(index, 1);
                    delete data.votos[id];
                    delete data.maxDB[id];

                    // If was voted for, reset vote
                    if (data.votedFor === id) {
                        data.hasVoted = false;
                        data.votedFor = null;
                    }

                    // If was selected, deselect
                    if (selectedComedianId === id) {
                        selectedComedianId = null;
                    }

                    saveData(data);
                    showMessage('‚úÖ Comediante eliminado', 'success');
                    refreshAll();
                    return true;
                }
            }
            return false;
        }

        function showMessage(message, type = 'error') {
            const alert = document.getElementById('config-alert');
            alert.textContent = message;
            alert.className = 'alert show ' + type;

            setTimeout(() => {
                alert.classList.remove('show');
            }, 3000);
        }

        // Form handling
        document.getElementById('comedian-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const id = document.getElementById('comedian-id').value;
            const name = document.getElementById('comedian-name').value;

            if (!name.trim()) {
                showMessage('‚ö†Ô∏è El nombre no puede estar vac√≠o');
                return;
            }

            if (id) {
                // Edit mode
                editComedian(parseInt(id), name);
            } else {
                // Add mode
                addComedian(name);
            }

            // Reset form
            this.reset();
            document.getElementById('comedian-id').value = '';
            document.getElementById('form-title').textContent = '‚ûï Agregar Nuevo Comediante';
            document.getElementById('submit-btn').textContent = '‚úÖ Agregar Comediante';
            document.getElementById('cancel-btn').style.display = 'none';

            refreshAll();
        });

        function startEdit(id) {
            const comedians = getComedians();
            const comedian = comedians.find(c => c.id === id);

            if (comedian) {
                document.getElementById('comedian-id').value = id;
                document.getElementById('comedian-name').value = comedian.name;
                document.getElementById('form-title').textContent = '‚úèÔ∏è Editar Comediante';
                document.getElementById('submit-btn').textContent = 'üíæ Guardar Cambios';
                document.getElementById('cancel-btn').style.display = 'inline-block';

                // Scroll to form
                document.getElementById('comedian-form').scrollIntoView({ behavior: 'smooth' });
            }
        }

        function cancelEdit() {
            document.getElementById('comedian-form').reset();
            document.getElementById('comedian-id').value = '';
            document.getElementById('form-title').textContent = '‚ûï Agregar Nuevo Comediante';
            document.getElementById('submit-btn').textContent = '‚úÖ Agregar Comediante';
            document.getElementById('cancel-btn').style.display = 'none';
        }

        // Render functions
        function renderComedianList() {
            const comedians = getComedians();
            const container = document.getElementById('comedian-list');
            const emptyMsg = document.getElementById('empty-message');
            const countSpan = document.getElementById('comedian-count');

            countSpan.textContent = comedians.length;
            container.innerHTML = '';

            if (comedians.length === 0) {
                emptyMsg.style.display = 'block';
                return;
            }

            emptyMsg.style.display = 'none';

            comedians.forEach(comedian => {
                const li = document.createElement('li');
                li.className = 'comedian-list-item';

                li.innerHTML = `
                    <div class="comedian-list-name">${comedian.name}</div>
                    <div class="comedian-list-actions">
                        <button class="btn btn-small" onclick="startEdit(${comedian.id})">
                            ‚úèÔ∏è Editar
                        </button>
                        <button class="btn btn-small btn-danger" onclick="deleteComedian(${comedian.id})">
                            üóëÔ∏è Borrar
                        </button>
                    </div>
                `;

                container.appendChild(li);
            });
        }

        function renderComedianSelector() {
            const comedians = getComedians();
            const container = document.getElementById('comedian-selector');
            container.innerHTML = '';

            if (comedians.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #ff0000;">No hay comediantes cargados. And√° a Configuraci√≥n para agregar.</p>';
                return;
            }

            comedians.forEach(comedian => {
                const btn = document.createElement('button');
                btn.className = 'comedian-btn';
                btn.textContent = comedian.name;
                btn.onclick = () => selectComedian(comedian.id);

                if (selectedComedianId === comedian.id) {
                    btn.classList.add('selected');
                }

                container.appendChild(btn);
            });
        }

        function selectComedian(comedianId) {
            selectedComedianId = comedianId;
            currentSessionMax = 0;
            renderComedianSelector();
            updateCurrentComedianDisplay();
            updateComparison();
        }

        function updateCurrentComedianDisplay() {
            const comedians = getComedians();
            const comedian = comedians.find(c => c.id === selectedComedianId);
            const data = getData();

            if (comedian) {
                document.getElementById('current-comedian').textContent = `Midiendo: ${comedian.name}`;
                document.getElementById('max-counter').textContent = Math.round(data.maxDB[selectedComedianId] || 0);
            } else {
                document.getElementById('current-comedian').textContent = 'Seleccion√° un comediante';
                document.getElementById('max-counter').textContent = '0';
            }
        }

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');

            if (sectionId === 'ranking') {
                updateRanking();
            } else if (sectionId === 'stats') {
                updateStats();
            } else if (sectionId === 'aplausos') {
                updateComparison();
            } else if (sectionId === 'config') {
                renderComedianList();
            }
        }

        // Microphone functions
        async function toggleMicrophone() {
            if (!selectedComedianId) {
                alert('‚ö†Ô∏è Primero seleccion√° un comediante para medir');
                return;
            }

            if (!isListening) {
                await startMicrophone();
            } else {
                stopMicrophone();
            }
        }

        async function startMicrophone() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                microphone = audioContext.createMediaStreamSource(stream);

                analyser.fftSize = 256;
                bufferLength = analyser.frequencyBinCount;
                dataArray = new Uint8Array(bufferLength);

                microphone.connect(analyser);

                isListening = true;
                currentSessionMax = 0;
                document.getElementById('mic-button').classList.add('active');
                document.getElementById('mic-status').classList.add('active');
                document.getElementById('mic-status').classList.remove('inactive');
                document.getElementById('mic-status').textContent = 'üü¢ Micr√≥fono Activo - Midiendo';

                document.getElementById('mic-error').classList.remove('show');

                analyzeVolume();
            } catch (error) {
                console.error('Error accessing microphone:', error);
                document.getElementById('mic-error').classList.add('show');
            }
        }

        function stopMicrophone() {
            if (audioContext) {
                audioContext.close();
            }
            if (animationId) {
                cancelAnimationFrame(animationId);
            }

            isListening = false;
            document.getElementById('mic-button').classList.remove('active');
            document.getElementById('mic-status').classList.remove('active');
            document.getElementById('mic-status').classList.add('inactive');
            document.getElementById('mic-status').textContent = 'üî¥ Micr√≥fono Apagado';
            document.getElementById('volume-bar').style.width = '0%';
            document.getElementById('volume-value').textContent = '0%';
        }

        function analyzeVolume() {
            if (!isListening) return;

            analyser.getByteFrequencyData(dataArray);

            let sum = 0;
            for (let i = 0; i < bufferLength; i++) {
                sum += dataArray[i];
            }
            const average = sum / bufferLength;
            const volumePercent = Math.min(100, (average / 255) * 100);

            document.getElementById('volume-bar').style.width = volumePercent + '%';
            document.getElementById('volume-value').textContent = Math.round(volumePercent) + '%';

            if (volumePercent > currentSessionMax) {
                currentSessionMax = volumePercent;
                document.getElementById('max-marker').style.left = volumePercent + '%';

                const data = getData();
                if (volumePercent > (data.maxDB[selectedComedianId] || 0)) {
                    data.maxDB[selectedComedianId] = Math.round(volumePercent);
                    saveData(data);

                    updateCurrentComedianDisplay();
                    updateComparison();

                    const counter = document.getElementById('max-counter');
                    counter.style.transform = 'scale(1.2)';
                    counter.style.color = '#00ff00';
                    setTimeout(() => {
                        counter.style.transform = 'scale(1)';
                        counter.style.color = '#ffff00';
                    }, 300);

                    confetti({
                        particleCount: 50,
                        spread: 60,
                        origin: { y: 0.7 },
                        colors: ['#ff00ff', '#00ffff', '#ffff00']
                    });
                }
            }

            animationId = requestAnimationFrame(analyzeVolume);
        }

        function resetCurrentMax() {
            if (!selectedComedianId) {
                alert('‚ö†Ô∏è Primero seleccion√° un comediante');
                return;
            }

            if (confirm('¬øReiniciar el m√°ximo de este comediante?')) {
                const data = getData();
                data.maxDB[selectedComedianId] = 0;
                saveData(data);
                currentSessionMax = 0;
                document.getElementById('max-marker').style.left = '0%';
                updateCurrentComedianDisplay();
                updateComparison();
            }
        }

        // Slider controls
        document.getElementById('smoothing-slider').addEventListener('input', function() {
            const value = this.value;
            document.getElementById('smoothing-value').textContent = value;
            if (analyser) {
                analyser.smoothingTimeConstant = parseFloat(value);
            }
        });

        // Comparison
        function updateComparison() {
            const comedians = getComedians();
            const data = getData();
            const container = document.getElementById('comparison-grid');
            container.innerHTML = '';

            if (comedians.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #ff0000;">No hay comediantes para comparar</p>';
                return;
            }

            const maxGlobal = Math.max(...comedians.map(c => data.maxDB[c.id] || 0), 1);

            comedians.forEach(comedian => {
                const card = document.createElement('div');
                card.className = 'comparison-card';

                if (selectedComedianId === comedian.id) {
                    card.classList.add('active');
                }

                if ((data.maxDB[comedian.id] || 0) === maxGlobal && maxGlobal > 0) {
                    card.classList.add('winner');
                }

                card.innerHTML = `
                    <div class="comparison-name">${comedian.name}</div>
                    <div class="comparison-value">${Math.round(data.maxDB[comedian.id] || 0)}</div>
                    <div class="comparison-label">dB %</div>
                `;

                container.appendChild(card);
            });
        }

        // Ranking
        function updateRanking() {
            const comedians = getComedians();
            const data = getData();
            const rankingList = document.getElementById('ranking-list');
            rankingList.innerHTML = '';

            if (comedians.length === 0) {
                rankingList.innerHTML = '<p style="text-align: center; color: #ff0000;">No hay comediantes para rankear</p>';
                return;
            }

            const scores = comedians.map(comedian => ({
                ...comedian,
                votos: data.votos[comedian.id] || 0,
                maxDB: Math.round(data.maxDB[comedian.id] || 0),
                score: (data.votos[comedian.id] || 0) * 10 + Math.round(data.maxDB[comedian.id] || 0)
            }));

            scores.sort((a, b) => b.score - a.score);

            const maxScore = Math.max(...scores.map(s => s.score), 1);

            scores.forEach((comedian, index) => {
                const li = document.createElement('li');
                li.className = 'ranking-item';
                if (index === 0 && comedian.score > 0) li.classList.add('first');

                const barWidth = (comedian.score / maxScore) * 100;

                li.innerHTML = `
                    <div class="ranking-position">${index + 1}</div>
                    <div class="ranking-info">
                        <div class="ranking-name">${comedian.name}</div>
                        <div class="ranking-bar">
                            <div class="ranking-bar-fill" style="width: ${barWidth}%">
                                ${comedian.votos} votos √ó 10 + ${comedian.maxDB} dB
                            </div>
                        </div>
                    </div>
                    <div class="ranking-score">${comedian.score}</div>
                `;

                rankingList.appendChild(li);
            });
        }

        // Statistics
        function updateStats() {
            const comedians = getComedians();
            const data = getData();

            document.getElementById('stat-registrados').textContent = data.registrados.length;

            const totalVotos = Object.values(data.votos).reduce((sum, v) => sum + v, 0);
            document.getElementById('stat-votos').textContent = totalVotos;

            const maxGlobal = Math.max(...comedians.map(c => data.maxDB[c.id] || 0), 0);
            document.getElementById('stat-max-global').textContent = Math.round(maxGlobal);

            document.getElementById('stat-comediantes').textContent = comedians.length;
        }

        // Reset function
        function resetAll() {
            if (confirm('‚ö†Ô∏è ¬øEst√°s seguro? Esto borrar√° TODOS los datos (registros, votos y m√°ximos).')) {
                if (confirm('üö® √öLTIMA CONFIRMACI√ìN: Esta acci√≥n no se puede deshacer.')) {
                    if (isListening) {
                        stopMicrophone();
                    }

                    localStorage.removeItem('comedyBattle');
                    initializeData();
                    selectedComedianId = null;
                    currentSessionMax = 0;
                    alert('‚úÖ Todos los datos han sido reiniciados.');
                    location.reload();
                }
            }
        }

        // Export data
        function exportData() {
            const data = getData();
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'comedy-battle-data-' + new Date().toISOString().split('T')[0] + '.json';
            link.click();
            URL.revokeObjectURL(url);
        }

        // Refresh all displays
        function refreshAll() {
            renderComedianList();
            renderComedianSelector();
            updateCurrentComedianDisplay();
            updateComparison();
            updateRanking();
            updateStats();
        }

        // Initialize
        initializeData();
        refreshAll();

        // Auto-refresh
        setInterval(() => {
            const currentSection = document.querySelector('section.active').id;
            if (currentSection === 'ranking') {
                updateRanking();
            } else if (currentSection === 'stats') {
                updateStats();
            } else if (currentSection === 'aplausos' && !isListening) {
                updateComparison();
            }
        }, 3000);

        // Clean up on page unload
        window.addEventListener('beforeunload', () => {
            if (isListening) {
                stopMicrophone();
            }
        });
    </script>
</body>
</html>
